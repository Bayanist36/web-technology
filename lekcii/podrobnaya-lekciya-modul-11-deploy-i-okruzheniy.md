---
order: 12
title: "Лекция 11. Деплой и окружения "
---

**Цель:** Научить студентов готовить фронтенд и бэкенд к публикации, настраивать переменные окружения и выполнять деплой современного веб-приложения на облачные платформы Vercel (фронтенд) и Render (бэкенд).

---

## Часть 1: Введение и Теоретическая Основа

### 1\.1. Вступление: от локального к глобальному

**Преподаватель:** Добрый день, коллеги! За 10 модулей мы с вами проделали колоссальную работу.\
-- В **Модулях 1–3** мы создали структуру, стиль и поведение веб-страницы.\
-- В **Модуле 4** мы освоили два мощных инструмента: Git/GitHub и htmx.\
-- В **Модулях 5–6** мы погрузились в мир **React**, научившись создавать компонентные интерфейсы и работать с внешними API.\
-- В **Модулях 7–9** мы создали сервер на **Node.js + Express**, подключили его к облачной базе данных **MongoDB** и построили профессиональное **REST API**.\
-- В **Модуле 10** мы добавили критически важный слой безопасности -- **аутентификацию на JWT**, чтобы каждый пользователь видел только свои данные.

Наше приложение -- **To-Do List** -- теперь является полноценным, безопасным и функциональным веб-сервисом. Но есть один нюанс: оно живёт **только на вашем компьютере**. Чтобы показать его друзьям, работодателю или всему миру, нужно сделать следующий шаг.

**Сегодня мы сделаем этот шаг.**

Наша новая задача -- **деплой (deployment)**. Это процесс публикации вашего приложения на сервере в интернете. После деплоя ваше приложение получает публичный URL и становится доступным **24/7 любому человеку в мире**.

И для этого мы выберем две современные, простые и бесплатные облачные платформы:

-  **Vercel** -- идеальное решение для деплоя React-приложений.

-  **Render** -- отличная платформа для деплоя Node.js-бэкендов.

После этого занятия ваш To-Do List перестанет быть учебным проектом и станет **живым, работающим приложением в вашем портфолио**.

---

### 1\.2. Подготовка к продакшену: переменные окружения и сборка

**Преподаватель:** Прежде чем отправить код в облако, его нужно правильно подготовить. Процесс разработки (`dev`) и эксплуатации (`prod`) сильно отличаются.

**Переменные окружения (.env)** -- это первый и самый важный аспект безопасности.

-  Конфиденциальные данные, такие как строка подключения к MongoDB (`MONGO_URI`) или секретный ключ для JWT (`JWT_SECRET`), **никогда не должны быть в коде**.

-  Они хранятся в файле `.env`, который **не коммитится в Git** (он должен быть в `.gitignore`).

-  На платформах (Vercel, Render) эти переменные задаются вручную в настройках сервиса, что гарантирует их безопасность.

**Режимы разработки и продакшена:**

-  **dev (разработка):** Вы запускаете проект командой `npm start`. WebStorm и React Dev Server обеспечивают hot-reload, подробные логи и инструменты разработчика. Это удобно, но медленно и неоптимизировано.

-  **prod (продакшен):** Для публикации React-приложение проходит **оптимизацию**. Команда `npm run build` собирает весь ваш код в единую, минифицированную и сжатую папку `build`, содержащую только статические HTML, CSS и JS файлы. Это то, что будет отдавать Vercel.

**Подготовка бэкенда:**\
Ваш сервер на Express должен быть готов к работе в облаке:

-  Все конфиденциальные данные вынесены в `.env`.

-  Сервер запускается простой командой `node server.js`.

-  Порт для запуска берётся из переменной окружения (`process.env.PORT || 5000`), так как облачные платформы сами задают порт.

---

### 1\.3. Процесс деплоя и настройка сервисов

**Преподаватель:** Теперь давайте разберём, как именно происходит деплой на выбранных платформах.

**Деплой фронтенда на Vercel:**

1. Vercel напрямую интегрируется с GitHub. Вы связываете свой аккаунт Vercel с GitHub.

2. Указываете репозиторий с вашим React-приложением.

3. Vercel автоматически:

   -  Клонирует репозиторий.

   -  Выполняет `npm install` для установки зависимостей.

   -  Выполняет `npm run build` для создания оптимизированной сборки.

   -  Размещает содержимое папки `build` на своём CDN.

4. Через несколько секунд ваше приложение получает уникальный URL вида `https://my-app.vercel.app`.

**Деплой бэкенда на Render:**

1. Вы создаёте новый **Web Service** на Render.

2. Указываете репозиторий с вашим сервером.

3. Задаёте команду запуска: `node server.js`.

4. **Самый важный шаг:** В разделе **Environment Variables** вы вручную добавляете все переменные из вашего `.env` файла (`MONGO_URI`, `JWT_SECRET`).

5. Render клонирует репозиторий, устанавливает зависимости и запускает ваш сервер. Вы получаете URL вида `https://my-server.onrender.com`.

**Финальная настройка:**\
После деплоя обоих частей нужно обновить URL бэкенда в коде фронтенда. Вместо `http://localhost:5000` ваш React-код должен обращаться к `https://my-server.onrender.com`. Это можно сделать, заменив URL напрямую или, что лучше, используя переменную окружения на фронтенде.

## Часть 2: Практическая Часть в WebStorm 

### 2\.1. Подготовка проектов 

**Преподаватель:** Отлично! Теория усвоена, теперь перейдём к практике. Нам нужно подготовить два проекта: фронтенд и бэкенд.

#### **Подготовка фронтенда (React):**

1. **Откройте проект в WebStorm:**\
   Откройте ваш React-проект (`my-todo-app` или аналогичный) в WebStorm.

2. **Выполните сборку:**\
   В терминале WebStorm выполните команду:

   ```bash
   npm run build
   ```

   Эта команда запустит процесс оптимизации: минификацию HTML, CSS и JS, а также создаст папку `build` в корне проекта. Эта папка содержит всё, что нужно для публикации.

3. **Проверьте сборку:**\
   Убедитесь, что папка `build` создана и содержит файлы `index.html`, `static/` и т.д.

4. **Обновите URL бэкенда:**\
   В вашем коде (например, в компоненте `App.js`) найдите все `fetch`\-запросы. Замените `http://localhost:5000` на относительный путь или переменную:

   ```jsx
   // Вместо этого:
   fetch('http://localhost:5000/api/todos')
   // Используйте это (после деплоя бэкенда вы просто обновите .env на Vercel):
   fetch('/api/todos')
   ```

   Это позволит Vercel перенаправлять запросы на ваш бэкенд через прокси.

#### **Подготовка бэкенда (Express):**

1. **Откройте проект в WebStorm (в новом окне):**\
   Откройте ваш серверный проект (`feedback-server` или аналогичный).

2. **Проверьте** `**.env**`**:**\
   Убедитесь, что все конфиденциальные данные (MONGO_URI, JWT_SECRET) вынесены в файл `.env`.

3. **Настройте CORS:**\
   Обновите middleware CORS в `server.js`, чтобы разрешить запросы **только с вашего домена на Vercel**:

   ```javascript
   const cors = require('cors');
   const corsOptions = {
     origin: 'https://my-todo-app.vercel.app' // Замените на ваш URL после деплоя
   };
   app.use(cors(corsOptions));
   ```

   Это критически важно для безопасности.

4. **Убедитесь в правильном порте:**\
   Сервер должен слушать порт, заданный облачной платформой:

   ```javascript
   const PORT = process.env.PORT || 5000;
   app.listen(PORT, () => {
     console.log(`Сервер запущен на порту ${PORT}`);
   });
   ```

---

### 2\.2. Практические задачи 

#### **Задача 1: Деплой фронтенда на Vercel** 

1. **Установите Vercel CLI:**\
   В терминале (вне проекта) выполните:

   ```bash
   npm i -g vercel
   ```

2. **Запустите деплой:**\
   Перейдите в корень вашего React-проекта и выполните:

   ```bash
   vercel
   ```

3. **Следуйте инструкциям:**

   -  Авторизуйтесь через GitHub.

   -  Выберите организацию (обычно ваш личный аккаунт).

   -  Подтвердите имя проекта.

   -  Убедитесь, что команда сборки -- `npm run build`, а выходная директория -- `build`.

4. **Дождитесь завершения:**\
   Vercel выведет URL вида `https://my-todo-app.vercel.app`. Скопируйте его.

#### **Задача 2: Деплой бэкенда на Render** 

1. **Зарегистрируйтесь на Render:**\
   Перейдите на <https://render.com> и создайте аккаунт.

2. **Создайте Web Service:**

   -  Нажмите **New** -> **Web Service**.

   -  Выберите репозиторий с вашим сервером.

3. **Настройте сервис:**

   -  **Name:** `my-todo-api`

   -  **Branch:** `main`

   -  **Runtime:** `Node`

   -  **Build Command:** `npm install`

   -  **Start Command:** `node server.js`

4. **Настройте переменные окружения:**

   -  В разделе **Environment Variables** добавьте:

      -  `MONGO_URI` -- ваша строка подключения к MongoDB Atlas.

      -  `JWT_SECRET` -- ваш секретный ключ.

   -  Нажмите **Add Environment Variable** для каждого.

5. **Создайте сервис:**\
   Нажмите **Create Web Service**. Render начнёт деплой. Дождитесь, пока статус не станет **Live**. Скопируйте URL вида `https://my-todo-api.onrender.com`.

#### **Задача 3: Финальная настройка и тестирование**

1. **Обновите прокси на фронтенде:**\
   Чтобы Vercel перенаправлял запросы `/api` на ваш бэкенд, создайте файл `vercel.json` в корне React-проекта:

   ```json
   {
     "rewrites": [
       { "source": "/api/(.*)", "destination": "https://my-todo-api.onrender.com/api/$1" }
     ]
   }
   ```

2. **Закоммитьте и запушьте изменения:**

   ```bash
   git add .
   git commit -m "Add Vercel proxy config"
   git push
   ```

3. **Перезапустите деплой на Vercel:**\
   Vercel автоматически перехватит новый коммит и пересоберёт проект.

4. **Протестируйте приложение:**\
   Откройте URL вашего фронтенда в браузере. Пройдите полный цикл:

   -  Зарегистрируйтесь.

   -  Войдите в систему.

   -  Добавьте, отметьте и удалите задачи.

   -  Убедитесь, что данные сохраняются и синхронизируются.

**Преподаватель:** Поздравляю! Ваше приложение теперь живёт в облаке и доступно всему миру!

## Часть 3: Мини-проект, ДЗ и Заключение (15 минут)

### 3.1. Мини-проект: «Онлайн-версия To-Do» (5 минут)

**Преподаватель:** Отлично! Вы успешно задеплоили обе части вашего приложения. Теперь у вас есть **живой, работающий To-Do List**, доступный по публичным URL. Это не просто учебный проект — это полноценное веб-приложение, которое может использовать любой человек в мире.

**Требования к финальному результату:**
*   **Фронтенд** доступен по адресу вида `https://my-todo-app.vercel.app`.
*   **Бэкенд** доступен по адресу вида `https://my-todo-api.onrender.com`.
*   Приложение полностью функционально:
    *   Регистрация и вход работают.
    *   Задачи создаются, отмечаются как выполненные и удаляются.
    *   Данные сохраняются в MongoDB и не теряются между сессиями.
    *   Каждый пользователь видит только свои задачи.

**План финальной проверки:**
1.  Откройте URL фронтенда в **инкогнито-режиме** браузера (чтобы не было старых данных в `localStorage`).
2.  Зарегистрируйте нового пользователя.
3.  Войдите в систему.
4.  Добавьте несколько задач.
5.  Обновите страницу — задачи должны остаться на месте.
6.  Попросите друга или коллегу открыть тот же URL и зарегистрироваться под другим email. Убедитесь, что его задачи не видны вам и наоборот.

**Преподаватель:** Поздравляю! Вы только что завершили цикл разработки современного веб-приложения от идеи до публичного релиза. Это огромное достижение.

---

### 3.2. Домашнее задание (3 минуты)

**Преподаватель:** Чтобы закрепить материал и сделать ваше приложение ещё более профессиональным, выполните домашнее задание.

**Задание:** Улучшить продакшен-версию.

**Требования:**
1.  **Настроить строгий CORS:**  
    В файле `server.js` обновите middleware CORS, чтобы он разрешал запросы **только с вашего домена на Vercel**:
    ```javascript
    const corsOptions = {
      origin: 'https://my-todo-app.vercel.app' // Замените на ваш реальный URL
    };
    app.use(cors(corsOptions));
    ```
    Это повысит безопасность вашего API.
2.  **Добавить логирование запросов:**  
    Установите библиотеку `morgan`:
    ```bash
    npm install morgan
    ```
    Подключите её в `server.js`:
    ```javascript
    const morgan = require('morgan');
    app.use(morgan('combined')); // Логирует все запросы в консоль
    ```
    Это поможет вам отслеживать активность на вашем сервере через логи Render.

**Критерии оценки:**
*   **Оценка 5 (Отлично):** Задание выполнено полностью. CORS настроен строго, логирование работает и видно в логах Render.
*   **Оценка 4 (Хорошо):** Есть мелкие недочёты (например, логирование есть, но CORS разрешает все домены).
*   **Оценка 3 (Удовлетворительно):** Выполнен только базовый деплой без улучшений.

**Срок сдачи:** [Укажите дату].

---

### 3.3. Контрольные вопросы и Заключение (7 минут)

**Преподаватель:** Давайте подведём итоги и проверим, насколько хорошо вы усвоили материал. Я задам несколько вопросов.

**Контрольные вопросы:**

1.  **Что должно храниться в файле `.env` и почему его нельзя коммитить?**  
    *Ответ:* В `.env` хранятся конфиденциальные данные: строки подключения к базам данных, секретные ключи (JWT), API-ключи. Его нельзя коммитить, потому что это приведёт к утечке этих данных в публичный репозиторий на GitHub, что поставит под угрозу безопасность вашего приложения.

2.  **Как проверить, что ваш сервис успешно задеплоен и работает?**  
    *Ответ:* Открыть публичный URL сервиса в браузере и протестировать его функциональность. Для бэкенда можно также отправить тестовый запрос через Postman или WebStorm HTTP Client и проверить, что возвращается корректный ответ и статус-код.

3.  **Что такое CORS и зачем он нужен в продакшене?**  
    *Ответ:* CORS (Cross-Origin Resource Sharing) — это механизм безопасности браузера, который по умолчанию запрещает веб-странице делать запросы на другой домен. В продакшене его нужно настраивать, чтобы разрешить вашему фронтенду (на Vercel) общаться с вашим бэкендом (на Render), но при этом запретить запросы от неизвестных источников для безопасности.

**Заключение:**

**Преподаватель:** Сегодня мы завершили цикл разработки. Мы прошли путь от простой HTML-страницы до полноценного, безопасного и **публичного веб-приложения**, которое живёт в облаке и доступно всему миру.

Теперь у вас в портфолио есть не просто код, а **живой проект**, который вы можете показать работодателю. Вы освоили полный стек современной веб-разработки: фронтенд на React, бэкенд на Node.js, база данных MongoDB, аутентификация и деплой.

В следующем, **Модуле 12**, вы примените все эти навыки для создания собственного **итогового проекта** на любую тему. Это будет ваш шедевр, ваша визитная карточка в мире разработки.

**Спасибо за внимание и за проделанную работу!** Удачи в выполнении домашнего задания и в создании вашего итогового проекта!